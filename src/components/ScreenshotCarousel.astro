---
// ScreenshotCarousel.astro - Pure CSS scroll-snap carousel for showcasing BARAS screenshots
import barasInAction from '../assets/screenshots/baras-in-action.png';
import barasOverlays from '../assets/screenshots/baras-overlays.png';
import barasTimerCustomization from '../assets/screenshots/baras-timer-customization.png';
import barasEffects from '../assets/screenshots/baras-effects.png';
import barasDataExplorer from '../assets/screenshots/baras-data-explorer.png';

const screenshots = [
  {
    src: barasInAction.src,
    alt: 'BARAS in action during raid combat',
    caption: 'BARAS In Action',
  },
  {
    src: barasOverlays.src,
    alt: 'DPS overlay showing real-time damage meters',
    caption: 'Real-time DPS Overlays',
  },
  {
    src: barasTimerCustomization.src,
    alt: 'Timer customization settings',
    caption: 'Custom Boss Timers',
  },
  {
    src: barasEffects.src,
    alt: 'Effects tracking display',
    caption: 'Effects Tracking',
  },
  {
    src: barasDataExplorer.src,
    alt: 'Data explorer showing combat analysis',
    caption: 'Data Explorer',
  },
];
---

<div class="carousel-container">
  <button class="carousel-arrow carousel-arrow-left" aria-label="Previous slide">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
  </button>

  <div class="carousel" role="region" aria-label="Screenshot carousel">
    {screenshots.map((screenshot, index) => (
      <div class="carousel-slide" id={`slide-${index}`} data-index={index}>
        <img src={screenshot.src} alt={screenshot.alt} loading="lazy" />
        <div class="carousel-caption">{screenshot.caption}</div>
      </div>
    ))}
  </div>

  <button class="carousel-arrow carousel-arrow-right" aria-label="Next slide">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </button>

  <nav class="carousel-nav" aria-label="Carousel navigation">
    {screenshots.map((_, index) => (
      <button
        class="carousel-dot"
        data-slide={index}
        aria-label={`Go to slide ${index + 1}`}
      />
    ))}
  </nav>
</div>

<script>
  const carousel = document.querySelector('.carousel') as HTMLElement;
  const slides = document.querySelectorAll('.carousel-slide');
  const dots = document.querySelectorAll('.carousel-dot');
  const leftArrow = document.querySelector('.carousel-arrow-left');
  const rightArrow = document.querySelector('.carousel-arrow-right');
  let currentSlide = 0;

  function goToSlide(index: number) {
    if (index < 0) index = slides.length - 1;
    if (index >= slides.length) index = 0;
    currentSlide = index;
    const slide = slides[index] as HTMLElement;
    carousel.scrollTo({ left: slide.offsetLeft - carousel.offsetLeft, behavior: 'smooth' });
    updateDots();
  }

  function updateDots() {
    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i === currentSlide);
    });
  }

  leftArrow?.addEventListener('click', () => goToSlide(currentSlide - 1));
  rightArrow?.addEventListener('click', () => goToSlide(currentSlide + 1));

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => goToSlide(index));
  });

  // Update current slide on scroll
  carousel.addEventListener('scrollend', () => {
    const scrollLeft = carousel.scrollLeft;
    slides.forEach((slide, index) => {
      const slideEl = slide as HTMLElement;
      if (Math.abs(slideEl.offsetLeft - carousel.offsetLeft - scrollLeft) < 50) {
        currentSlide = index;
        updateDots();
      }
    });
  });

  updateDots();
</script>

<style>
  .carousel-container {
    max-width: 850px;
    margin: 2rem auto;
    position: relative;
  }

  .carousel {
    display: flex;
    align-items: flex-start;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    gap: 1rem;
    padding: 0.5rem;
    border-radius: 8px;
  }

  /* Hide scrollbar */
  .carousel::-webkit-scrollbar {
    display: none;
  }
  .carousel {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .carousel-slide {
    flex: 0 0 100%;
    scroll-snap-align: center;
    position: relative;
    border-radius: 6px;
    overflow: hidden;
  }

  .carousel-slide img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 6px;
  }

  .carousel-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: var(--sl-color-white);
    font-size: 1rem;
    font-weight: 600;
    text-align: center;
  }

  /* Arrow buttons */
  .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--sl-color-gray-2);
  }

  .carousel-arrow:hover {
    background: var(--sl-color-accent);
    border-color: var(--sl-color-accent);
    color: var(--sl-color-white);
  }

  .carousel-arrow svg {
    width: 20px;
    height: 20px;
  }

  .carousel-arrow-left {
    left: -50px;
  }

  .carousel-arrow-right {
    right: -50px;
  }

  .carousel-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .carousel-dot {
    width: 12px;
    height: 12px;
    min-width: 12px;
    min-height: 12px;
    max-width: 12px;
    max-height: 12px;
    padding: 0;
    margin: 0;
    border-radius: 50%;
    background: var(--sl-color-gray-4);
    border: 2px solid var(--sl-color-gray-5);
    box-sizing: border-box;
    flex-shrink: 0;
    transition: background 0.2s ease, border-color 0.2s ease;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
  }

  .carousel-dot:hover,
  .carousel-dot:focus,
  .carousel-dot.active {
    background: var(--sl-color-accent);
    border-color: var(--sl-color-accent);
  }


  /* Responsive adjustments */
  @media (max-width: 950px) {
    .carousel-arrow-left {
      left: 10px;
    }
    .carousel-arrow-right {
      right: 10px;
    }
    .carousel-arrow {
      background: rgba(41, 37, 36, 0.8);
    }
  }

  @media (max-width: 640px) {
    .carousel-container {
      margin: 1rem auto;
    }

    .carousel {
      gap: 0.5rem;
      padding: 0.25rem;
    }

    .carousel-caption {
      font-size: 0.875rem;
      padding: 0.75rem;
    }

    .carousel-dot {
      width: 10px;
      height: 10px;
    }

    .carousel-arrow {
      width: 32px;
      height: 32px;
    }

    .carousel-arrow svg {
      width: 16px;
      height: 16px;
    }
  }
</style>

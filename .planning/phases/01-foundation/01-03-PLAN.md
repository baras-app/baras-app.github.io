---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - astro.config.mjs
  - src/styles/custom.css
  - src/content/docs/index.mdx
autonomous: false

must_haves:
  truths:
    - "Site uses dark charcoal background with teal/cyan accents"
    - "Dark mode is the default theme"
    - "Dark mode toggle is visible in header and persists preference"
    - "Site is readable on mobile with hamburger menu"
    - "Search box finds content across documentation"
    - "Code blocks have copy-to-clipboard buttons"
    - "Images use Astro Image component with WebP and lazy loading"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Starlight theme customization and image service config"
      contains: "customCss"
    - path: "src/styles/custom.css"
      provides: "Custom color scheme and styling"
      contains: "dark"
  key_links:
    - from: "astro.config.mjs"
      to: "src/styles/custom.css"
      via: "customCss import"
      pattern: "customCss.*custom.css"
---

<objective>
Configure Starlight theme with BARAS brand colors, verify all UX features work correctly, and ensure image optimization pipeline is configured.

Purpose: Match the site's visual identity to BARAS app aesthetic, ensure all core UX requirements (dark mode, mobile, search, copy buttons) are functional, and set up image optimization for future content.
Output: Themed documentation site that feels like it belongs to the BARAS app family, with image optimization ready.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Starlight theme and custom colors</name>
  <files>
    astro.config.mjs
    src/styles/custom.css
  </files>
  <action>
    Apply BARAS brand colors from CONTEXT.md:
    - Dark charcoal background
    - Teal/cyan primary accent
    - Gold/tan for branding elements

    1. Create src/styles/custom.css with CSS custom properties:
       ```css
       /* BARAS brand colors */
       :root {
         /* Teal/cyan accent */
         --sl-color-accent-low: #083344;
         --sl-color-accent: #0891b2;
         --sl-color-accent-high: #22d3ee;

         /* Gold/tan for branding highlights */
         --sl-color-white: #fafaf9;
         --sl-color-gray-1: #e7e5e4;
         --sl-color-gray-2: #d6d3d1;
         --sl-color-gray-3: #a8a29e;
         --sl-color-gray-4: #78716c;
         --sl-color-gray-5: #57534e;
         --sl-color-gray-6: #292524;

         /* Dark charcoal background */
         --sl-color-black: #1c1917;
       }

       /* Dark mode as default - invert for light mode */
       :root[data-theme='light'] {
         --sl-color-accent-low: #cffafe;
         --sl-color-accent: #0891b2;
         --sl-color-accent-high: #083344;
       }
       ```

    2. Update astro.config.mjs to:
       - Import custom CSS: `customCss: ['./src/styles/custom.css']`
       - Set default color mode if Starlight supports it (check docs)

    3. Starlight provides these UX features by default - verify they're enabled:
       - Dark mode toggle: Built-in, appears in header
       - Mobile responsive: Built-in hamburger menu
       - Search (Pagefind): Built-in, enabled by default
       - Copy buttons on code blocks: Built-in

    4. If any UX feature is disabled by default, enable it in astro.config.mjs

    5. Add a code block to index.mdx to test copy button:
       ```mdx
       ## Quick Example

       ```toml
       # Example BARAS config
       [overlay]
       enabled = true
       ```
       ```
  </action>
  <verify>
    npm run dev shows site with dark charcoal background and teal accents
  </verify>
  <done>
    Custom BARAS color scheme applied, matches brand aesthetic from CONTEXT.md
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure image optimization pipeline (INFRA-03)</name>
  <files>
    astro.config.mjs
    src/content/docs/index.mdx
  </files>
  <action>
    Set up Astro's built-in image optimization for WebP conversion and lazy loading:

    1. Verify astro.config.mjs uses Sharp image service (default):
       - Astro uses Sharp by default for image optimization
       - No explicit configuration needed unless using edge runtime
       - Confirm no `image: { service: { entrypoint: 'astro/assets/services/noop' } }` is present

    2. Document image usage pattern for future content in index.mdx:
       - Add a comment or example showing how to use <Image /> component
       - Example import: `import { Image } from 'astro:assets';`
       - Example usage: `<Image src={import('./path/to/image.png')} alt="description" />`

    3. Create src/assets/ directory for optimized images (Astro convention):
       - `mkdir -p src/assets/images`
       - Add a placeholder test image (can be simple SVG or small PNG)

    4. Add test image to index.mdx using Astro Image component:
       ```mdx
       ---
       import { Image } from 'astro:assets';
       import testImage from '../../assets/images/placeholder.svg';
       ---

       <Image src={testImage} alt="Test image for optimization verification" />
       ```

    5. Verify optimization works:
       - Run `npm run build`
       - Check dist/_astro/ for optimized image output
       - Inspect HTML output for `loading="lazy"` and `decoding="async"` attributes

    Note: Astro's Image component automatically:
    - Converts to WebP/AVIF where beneficial
    - Adds loading="lazy" and decoding="async"
    - Prevents Cumulative Layout Shift (CLS) with inferred dimensions
    - Optimizes at build time for static pages
  </action>
  <verify>
    npm run build succeeds; inspect dist/ HTML for lazy loading attributes on images
  </verify>
  <done>
    Image optimization pipeline configured: src/assets/ directory exists, Image component usage documented, build produces optimized images with lazy loading
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Themed Starlight site with BARAS brand colors, all UX features enabled, and image optimization pipeline configured
  </what-built>
  <how-to-verify>
    Run `npm run dev` and verify each UX requirement:

    1. **Dark mode default (UX-01)**:
       - Site loads in dark mode by default
       - Toggle in header switches to light mode
       - Refresh page - preference persists
       - Color scheme: dark charcoal background, teal/cyan accents

    2. **Mobile responsive (UX-02)**:
       - Resize browser to mobile width (< 768px)
       - Hamburger menu appears
       - Tap hamburger - sidebar slides in
       - Content is readable, no horizontal scroll

    3. **Search (UX-03)**:
       - Search box visible in header
       - Type "installation" - results appear
       - Click result - navigates to page

    4. **Copy buttons (UX-04)**:
       - Find a code block on the page
       - Hover over code block
       - Copy button appears
       - Click copy - code copied to clipboard

    5. **Image optimization (INFRA-03)**:
       - Run `npm run build && npm run preview`
       - Open browser DevTools, inspect any <img> tag
       - Verify `loading="lazy"` attribute present
       - Check Network tab - images should load on scroll, not all at once

    Note: Search may not work in dev mode (Pagefind indexes at build time).
    Run `npm run build && npm run preview` to test search and image optimization.
  </how-to-verify>
  <resume-signal>Type "approved" if all 5 items work (4 UX features + image optimization), or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Site uses dark charcoal background (not Starlight default blue)
2. Teal/cyan accent colors visible on links and highlights
3. Dark mode toggle in header works and persists
4. Mobile hamburger menu works
5. Search finds content (test after build)
6. Code block copy buttons work
7. Images have loading="lazy" and decoding="async" attributes
8. src/assets/images/ directory exists for future image content
</verification>

<success_criteria>
- All UX requirements met: UX-01, UX-02, UX-03, UX-04
- Infrastructure requirement met: INFRA-03 (image optimization)
- Visual identity matches BARAS app aesthetic per CONTEXT.md
- Site feels professional and gaming-focused, not generic docs
- Image optimization pipeline ready for Phase 2 screenshots
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>

---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .github/workflows/deploy.yml
  - astro.config.mjs
autonomous: false

must_haves:
  truths:
    - "Push to main branch triggers GitHub Actions workflow"
    - "Workflow builds Astro site successfully"
    - "Site is accessible at baras-app.github.io"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions deployment workflow"
      contains: "astro build"
    - path: "astro.config.mjs"
      provides: "Configured site URL for GitHub Pages"
      contains: "baras-app.github.io"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "GitHub Pages"
      via: "actions/deploy-pages"
      pattern: "deploy-pages"
---

<objective>
Set up GitHub Actions workflow to automatically build and deploy the Astro site to GitHub Pages.

Purpose: Enable continuous deployment so changes to main branch automatically update the live site.
Output: Working CI/CD pipeline that deploys to baras-app.github.io on every push.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions deployment workflow</name>
  <files>
    .github/workflows/deploy.yml
    astro.config.mjs
  </files>
  <action>
    Create GitHub Actions workflow for Astro + GitHub Pages deployment:

    1. Create .github/workflows/deploy.yml:
       ```yaml
       name: Deploy to GitHub Pages

       on:
         push:
           branches: [main]
         workflow_dispatch:

       permissions:
         contents: read
         pages: write
         id-token: write

       concurrency:
         group: "pages"
         cancel-in-progress: false

       jobs:
         build:
           runs-on: ubuntu-latest
           steps:
             - name: Checkout
               uses: actions/checkout@v4

             - name: Setup Node
               uses: actions/setup-node@v4
               with:
                 node-version: "20"
                 cache: "npm"

             - name: Install dependencies
               run: npm ci

             - name: Build Astro site
               run: npm run build

             - name: Upload artifact
               uses: actions/upload-pages-artifact@v3
               with:
                 path: ./dist

         deploy:
           needs: build
           runs-on: ubuntu-latest
           environment:
             name: github-pages
             url: ${{ steps.deployment.outputs.page_url }}
           steps:
             - name: Deploy to GitHub Pages
               id: deployment
               uses: actions/deploy-pages@v4
       ```

    2. Ensure astro.config.mjs has correct site URL:
       - site: 'https://baras-app.github.io'
       - No base path needed (this is the org's root site)

    3. Add package-lock.json if not present (needed for npm ci):
       - Run `npm install` to generate it if missing
  </action>
  <verify>
    File .github/workflows/deploy.yml exists with correct structure
  </verify>
  <done>
    GitHub Actions workflow file created with Astro build and Pages deployment steps
  </done>
</task>

<task type="auto">
  <name>Task 2: Push and verify deployment</name>
  <files>None (git operations only)</files>
  <action>
    1. Commit all changes:
       - .github/workflows/deploy.yml
       - Any package-lock.json updates

    2. Push to main branch

    3. Monitor GitHub Actions:
       - Use `gh run list` to see workflow status
       - Use `gh run view --log` if issues occur

    4. If GitHub Pages not configured as source:
       - Use `gh api repos/baras-app/baras-app.github.io/pages -X PUT -f build_type=workflow` to enable Pages from Actions
       - Or note that user needs to enable Pages in repo settings (Settings > Pages > Source: GitHub Actions)
  </action>
  <verify>
    `gh run list` shows successful workflow run, or workflow is in progress
  </verify>
  <done>
    Workflow triggered on push, build job completes successfully
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    GitHub Actions deployment pipeline that builds Astro site and deploys to GitHub Pages
  </what-built>
  <how-to-verify>
    1. Visit https://baras-app.github.io in your browser
    2. Verify the Starlight documentation site loads (not the old Jekyll page)
    3. Verify navigation sidebar appears
    4. Verify favicon shows in browser tab

    If site shows 404 or old Jekyll content:
    - Check GitHub repo Settings > Pages > ensure Source is "GitHub Actions"
    - Check Actions tab for any failed workflow runs
  </how-to-verify>
  <resume-signal>Type "approved" if site is live, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `.github/workflows/deploy.yml` exists with correct configuration
2. Push to main triggers workflow (check Actions tab)
3. Workflow completes successfully
4. Site is live at https://baras-app.github.io
</verification>

<success_criteria>
- Automated deployment works on push to main
- Site is publicly accessible at baras-app.github.io
- No manual deployment steps required going forward
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>

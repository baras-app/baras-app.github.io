---
phase: 02-landing-downloads
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/DownloadSection.astro
  - src/content/docs/index.mdx
  - src/styles/custom.css
autonomous: true

must_haves:
  truths:
    - "User can click platform-specific download button and download starts"
    - "Download buttons show current version number from GitHub Releases"
    - "All three platforms (Windows/macOS/Linux) have visible download options"
    - "User's detected platform is highlighted but others remain accessible"
  artifacts:
    - path: "src/components/DownloadSection.astro"
      provides: "Download buttons with GitHub API integration"
      min_lines: 80
      contains: "api.github.com"
    - path: "src/content/docs/index.mdx"
      provides: "Landing page with integrated downloads"
      contains: "DownloadSection"
  key_links:
    - from: "src/components/DownloadSection.astro"
      to: "https://api.github.com/repos/baras-app/baras/releases/latest"
      via: "client-side fetch in script tag"
      pattern: "fetch.*api.github.com.*releases"
    - from: "src/content/docs/index.mdx"
      to: "src/components/DownloadSection.astro"
      via: "import and component usage"
      pattern: "import.*DownloadSection"
---

<objective>
Create download section with platform-specific buttons that fetch release info from GitHub Releases API, detect user platform, and provide direct download links.

Purpose: Enable one-click downloads for Windows/macOS/Linux users with current version display
Output: DownloadSection.astro component with GitHub API integration, updated landing page
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-landing-downloads/02-RESEARCH.md

# Research provides GitHub API patterns and platform detection
# See: Pattern 1 (Client-Side Release Fetching), Code Examples section

# From Plan 02-01 (dependency)
@.planning/phases/02-landing-downloads/02-01-SUMMARY.md
@src/content/docs/index.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DownloadSection component with GitHub API integration</name>
  <files>
    src/components/DownloadSection.astro
    src/styles/custom.css
  </files>
  <action>
Create `src/components/DownloadSection.astro` with:

1. Static HTML structure (renders at build time):
```astro
---
// DownloadSection.astro - Platform downloads with GitHub Releases API
---

<section class="download-section" id="downloads">
  <h2>Download BARAS</h2>
  <p class="download-version">Loading version...</p>

  <div class="download-buttons">
    <a class="download-btn download-btn-windows" href="#" data-platform="windows">
      <span class="download-icon"><!-- Windows icon --></span>
      <span class="download-label">Windows</span>
      <span class="download-file">.exe installer</span>
    </a>
    <a class="download-btn download-btn-macos" href="#" data-platform="macos">
      <span class="download-icon"><!-- Apple icon --></span>
      <span class="download-label">macOS</span>
      <span class="download-file">.dmg</span>
    </a>
    <a class="download-btn download-btn-linux" href="#" data-platform="linux">
      <span class="download-icon"><!-- Linux icon --></span>
      <span class="download-label">Linux</span>
      <span class="download-file">.AppImage</span>
    </a>
  </div>

  <p class="download-alt">
    <a href="https://github.com/baras-app/baras/releases/latest">View all downloads on GitHub</a>
  </p>
</section>
```

2. Client-side script (runs in browser):
```javascript
<script>
const API_URL = 'https://api.github.com/repos/baras-app/baras/releases/latest';
const FALLBACK_URL = 'https://github.com/baras-app/baras/releases/latest';

// Platform detection (from research)
function detectPlatform() {
  const ua = navigator.userAgent;
  if (/Windows/i.test(ua)) return 'windows';
  if (/Macintosh|MacIntel|MacPPC|Mac68K/i.test(ua)) return 'macos';
  if (/Linux/i.test(ua) && !/Android/i.test(ua)) return 'linux';
  return 'windows'; // Default fallback
}

// Asset name patterns (from research - GitHub API response)
function findAsset(assets, platform) {
  const patterns = {
    windows: /_x64-setup\.exe$/,
    macos: /_aarch64\.dmg$/,  // Apple Silicon primary
    linux: /_amd64\.AppImage$/
  };
  return assets.find(a => patterns[platform]?.test(a.name));
}

async function loadReleases() {
  try {
    const response = await fetch(API_URL);
    if (!response.ok) throw new Error('API request failed');

    const release = await response.json();
    const version = release.tag_name; // e.g., "v2026.1.1901"

    // Update version display
    document.querySelector('.download-version').textContent = `Latest: ${version}`;

    // Update download buttons
    const buttons = document.querySelectorAll('.download-btn');
    buttons.forEach(btn => {
      const platform = btn.dataset.platform;
      const asset = findAsset(release.assets, platform);
      if (asset) {
        btn.href = asset.browser_download_url;
      } else {
        btn.href = FALLBACK_URL;
      }
    });

    // Highlight detected platform
    const detected = detectPlatform();
    document.querySelector(`[data-platform="${detected}"]`)?.classList.add('download-btn-primary');

  } catch (error) {
    console.warn('Failed to fetch releases:', error);
    // Fallback: link all buttons to releases page
    document.querySelector('.download-version').textContent = 'Latest version';
    document.querySelectorAll('.download-btn').forEach(btn => {
      btn.href = FALLBACK_URL;
    });
  }
}

document.addEventListener('DOMContentLoaded', loadReleases);
</script>
```

3. Use inline SVG icons for Windows, Apple, Linux (simple recognizable shapes):
   - Windows: Four-pane window shape
   - Apple: Apple silhouette
   - Linux: Tux penguin simplified

Add download section styles to `src/styles/custom.css`:
- `.download-section` container with centered text
- `.download-buttons` flex container with gap
- `.download-btn` card-style buttons with hover effects
- `.download-btn-primary` highlighted state for detected platform
- `.download-version` version text styling
- Responsive: stack vertically on mobile

Use existing BARAS color variables. Primary button uses --sl-color-accent.
  </action>
  <verify>
`npm run build` succeeds.
Component file exists with script tag containing fetch call.
CSS has download button styles.
  </verify>
  <done>
DownloadSection.astro exists with:
- Three platform download buttons (Windows/macOS/Linux)
- Client-side GitHub API fetch in script tag
- Platform detection that highlights user's OS
- Fallback to GitHub releases page on API failure
Download button styles added to custom.css.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate DownloadSection into landing page</name>
  <files>
    src/content/docs/index.mdx
  </files>
  <action>
Update `src/content/docs/index.mdx` to add the DownloadSection:

1. Add import at top with other imports:
```mdx
import DownloadSection from '../../components/DownloadSection.astro';
```

2. Replace the placeholder `#downloads` div (from Plan 02-01) with the component:
```mdx
## Download

<DownloadSection />
```

3. Position the download section:
   - After the screenshot carousel
   - Before the feature cards

4. Update hero action button to use smooth scroll:
   - Keep `link: '#downloads'` (browser handles smooth scroll to anchor)

Verify the page structure flows logically:
1. Hero with Download CTA
2. Screenshot carousel ("See BARAS in Action")
3. Download section
4. Feature cards
  </action>
  <verify>
`npm run build` succeeds.
`npm run dev` shows download buttons on landing page.
Clicking "Download" in hero scrolls to download section.
Open browser DevTools Network tab - verify GitHub API call on page load.
  </verify>
  <done>
DownloadSection integrated into index.mdx landing page.
Download buttons visible and functional.
Hero "Download" button links to download section.
GitHub API fetches release info on page load.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` produces no errors
2. Landing page shows three download buttons (Windows/macOS/Linux)
3. Version number appears after page load (from GitHub API)
4. User's platform button is highlighted
5. Clicking download button initiates file download (test with one platform)
6. If API fails, buttons link to GitHub releases page (test by blocking API in DevTools)
</verification>

<success_criteria>
- Platform-specific download buttons exist for Windows (.exe), macOS (.dmg), Linux (.AppImage) (LAND-03)
- Version number pulled from GitHub Releases API and displayed (LAND-04)
- Detected platform highlighted but all options visible
- Graceful fallback to GitHub releases page on API failure
</success_criteria>

<output>
After completion, create `.planning/phases/02-landing-downloads/02-02-SUMMARY.md`
</output>
